<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlickFinder PRO</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f172a; color: white; }
        .active { background-color: #ef4444 !important; }
    </style>
</head>
<body class="pb-20">
    <header class="p-4 bg-gray-900 flex justify-between items-center sticky top-0 z-50 shadow-xl">
        <h1 class="font-bold text-red-500">FLICK PRO</h1>
        <select id="mediaType" onchange="loadContent()" class="bg-gray-800 text-xs p-2 rounded-lg outline-none border border-gray-700">
            <option value="movie">MOVIES üé•</option>
            <option value="tv">TV SHOWS üì∫</option>
        </select>
    </header>

    <div class="p-4 flex gap-2 overflow-x-auto hide-scroll">
        <button onclick="loadContent('/trending')" class="bg-gray-800 px-4 py-2 rounded-full text-[10px] font-bold active">TRENDING</button>
        <button onclick="applyRating()" class="bg-gray-800 px-4 py-2 rounded-full text-[10px] font-bold">TOP RATED</button>
        <button onclick="applyYear()" class="bg-gray-800 px-4 py-2 rounded-full text-[10px] font-bold">YEAR</button>
    </div>

    <div id="grid" class="grid grid-cols-2 gap-4 p-4"></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready(); // ÿ™ŸÅÿπŸäŸÑ ÿßŸÑÿ¨ÿßŸáÿ≤Ÿäÿ©

        const API_URL = "https://yssef.pythonanywhere.com";
        const MONETAG = "https://otieu.com/4/10509481";

        async function loadContent(path = '/trending') {
            const grid = document.getElementById('grid');
            const type = document.getElementById('mediaType').value;
            grid.innerHTML = "<p class='col-span-2 text-center opacity-50'>Syncing Content...</p>";

            try {
                const url = `${API_URL}${path}${path.includes('?') ? '&' : '?'}type=${type}`;
                const response = await fetch(url);
                const data = await response.json();
                
                grid.innerHTML = data.map(m => `
                    <div class="bg-gray-800 rounded-2xl overflow-hidden shadow-lg" onclick="handleItemClick(${m.id})">
                        <img src="https://image.tmdb.org/t/p/w500${m.poster_path}" class="w-full h-56 object-cover">
                        <div class="p-3 text-[10px] font-bold truncate">${m.title || m.name}</div>
                    </div>
                `).join('');
            } catch (e) { grid.innerHTML = "<p class='col-span-2 text-center text-red-500'>Error</p>"; }
        }

        async function handleItemClick(id) {
            const type = document.getElementById('mediaType').value;
            
            // ÿ¨ŸÑÿ® ÿßŸÑÿ±ÿßÿ®ÿ∑ ŸÇÿ®ŸÑ ŸÅÿ™ÿ≠ ÿßŸÑŸÄ Popup ŸÑÿ∂ŸÖÿßŸÜ ÿßŸÑÿ≥ÿ±ÿπÿ©
            const res = await fetch(`${API_URL}/trailer?id=${id}&type=${type}`);
            const data = await res.json();
            const finalLink = data.link || "https://youtube.com";

            tg.showPopup({
                title: 'Watch Trailer',
                message: 'Select your preferred link:',
                buttons: [
                    {id: 'ad', type: 'default', text: 'üöÄ High Speed (Sponsor)'},
                    {id: 'yt', type: 'destructive', text: '‚ñ∂Ô∏è Direct YouTube'}
                ]
            }, (id) => {
                if(id === 'ad') tg.openLink(MONETAG);
                else if(id === 'yt') tg.openLink(finalLink);
            });
        }

        function applyRating() { loadContent('/discover?rating=8'); }
        function applyYear() { const y = prompt("Year:"); if(y) loadContent(`/discover?year=${y}`); }

        loadContent();
    </script>
</body>
</html>
