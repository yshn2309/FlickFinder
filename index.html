<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlickFinder PRO</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #0f172a; color: white; font-family: sans-serif; }
        .active-tab { background-color: #ef4444 !important; }
        .card { transition: 0.2s; }
        .card:active { transform: scale(0.95); }
    </style>
</head>
<body class="pb-20">

    <!-- Header -->
    <header class="p-4 bg-gray-900 flex justify-between items-center sticky top-0 z-50">
        <h1 class="font-bold text-red-500">FLICKFINDER PRO</h1>
        <select id="mediaType" onchange="loadContent()" class="bg-gray-800 text-xs p-2 rounded-lg outline-none">
            <option value="movie">Movies ğŸ¥</option>
            <option value="tv">TV Shows ğŸ“º</option>
        </select>
    </header>

    <!-- Filter Bar -->
    <div class="p-4 flex gap-2 overflow-x-auto">
        <button onclick="loadContent('/trending')" class="bg-gray-800 px-4 py-2 rounded-full text-xs whitespace-nowrap active-tab">Trending ğŸ”¥</button>
        <button onclick="applyRatingFilter()" class="bg-gray-800 px-4 py-2 rounded-full text-xs whitespace-nowrap">Top Rated â­</button>
        <button onclick="applyYearFilter()" class="bg-gray-800 px-4 py-2 rounded-full text-xs whitespace-nowrap">Year ğŸ—“ï¸</button>
    </div>

    <!-- Content Grid -->
    <div id="grid" class="grid grid-cols-2 gap-4 p-4"></div>

    <script>
        const tg = window.Telegram.WebApp;
        const API_URL = "https://yssef.pythonanywhere.com";
        const MONETAG = "https://otieu.com/4/10509481";

        async function loadContent(path = '/trending') {
            const grid = document.getElementById('grid');
            const type = document.getElementById('mediaType').value;
            grid.innerHTML = "<p class='col-span-2 text-center'>Loading...</p>";

            try {
                const response = await fetch(`${API_URL}${path}${path.includes('?') ? '&' : '?'}type=${type}`);
                const data = await response.json();
                
                grid.innerHTML = data.map(m => `
                    <div class="card bg-gray-800 rounded-xl overflow-hidden" onclick="showDetails(${m.id})">
                        <img src="https://image.tmdb.org/t/p/w500${m.poster_path}" class="w-full h-48 object-cover">
                        <div class="p-2 text-xs font-bold truncate">${m.title || m.name}</div>
                    </div>
                `).join('');
            } catch (e) {
                grid.innerHTML = "<p class='col-span-2 text-center text-red-500'>Error loading data</p>";
            }
        }

        function applyRatingFilter() {
            loadContent('/discover?rating=8');
        }

        function applyYearFilter() {
            const year = prompt("Enter Year (e.g. 2024):");
            if (year) loadContent(`/discover?year=${year}`);
        }

        function showDetails(id) {
            const type = document.getElementById('mediaType').value;
            // ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† (Smartlink) Ù„ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ø±Ø¨Ø­ ÙÙˆØ±Ø§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠ ÙÙŠÙ„Ù…
            tg.openLink(`${MONETAG}`);
            // ÙŠÙ…ÙƒÙ†Ùƒ Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø¥Ø¶Ø§ÙØ© Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ù‡Ù†Ø§
        }

        loadContent();
    </script>
</body>
</html>
